%% a multipath channel to transmit the signal between the pinger and hydrophone array.

% ten propagation paths including the direct path and reflections from the top 
% and bottom surfaces. The paths generated by isopaths will be used by the multipath 
% channel to simulate the signal propagation.

propSpeed = 1520; %Underwater sound propagation speed, (in m/s)
channelDepth = 4.9; %19ft depth to meters (SI system rocks)
OperatingFrequency = 37.5e3; 
%ff: phased.IsoSpeedUnderwaterPaths is used as an input to the multipath
%sound propagator, phased.MultipathChannel
isopaths = phased.IsoSpeedUnderwaterPaths( ...
    'ChannelDepth',channelDepth,...
  'NumPathsSource','Property', ...
  'NumPaths',10, ...
  'PropagationSpeed',propSpeed);

channel = phased.MultipathChannel('OperatingFrequency',OperatingFrequency);

%% Acoustic Beacon Waveform
% Defining the waveform emitted by the acoustic beacon
% @ a 1 second repetition interval and 1 millisecond width.

prf = 1; % pulse repetition frequency (unit: Hz)
pulseWidth = 1e-3;  % length of each pulse
% DurationSpecification equal to PulseWidth (by default)
pulseBandwidth = 1/pulseWidth;
fs = 2*pulseBandwidth; % sample rate
wav = phased.RectangularWaveform( ...
    'PRF',prf, ...
    'PulseWidth',pulseWidth, ...
    'SampleRate',fs);
channel.SampleRate = fs;

%% Acoustic Beacon
% located 1 meter above the bottom of the channel. 
% radiated sound intensity per unit input voltage to the projector
projector = phased.IsotropicProjector('VoltageResponse',120, 'BackBaffled', true);
% 'FrequencyRange',[LowerBound HigherBound]
% converts signals into radiated wavefields 
projRadiator = phased.Radiator('Sensor',projector,...
  'PropagationSpeed',propSpeed,'OperatingFrequency',OperatingFrequency);
% models the translational motion of a pinger in space
beaconPlat = phased.Platform( ...
    'InitialPosition',[5000; 2000; -199], ...
    'Velocity',[0; 0; 0]);
% INTIAL COORDINATES OF THE PINGER???

%% Passive Towed Array

% A passive towed array will detect and localize the source of the pings, 
% and is modeled as a five-element linear array with half-wavelength spacing. 
% The passive array has velocity of 1 m/s in the y-direction. 
% The array axis is oriented parallel to the direction of travel.
% IMP : hydrophone spacing should be greater than 2.45 (the diameter of the
% hydrophone), note; formula imp

hydrophone = phased.IsotropicHydrophone( ...
    'FrequencyRange',[10 100]*1e3, ...
    'VoltageSensitivity',-190, ...
    'BackBaffled', true);

array = phased.ULA( ...
    'Element',hydrophone, ...
    'NumElements',4, ...
    'ElementSpacing',propSpeed/OperatingFrequency/2, ...
    'ArrayAxis','y');

arrayCollector = phased.Collector( ...
    'Sensor',array, ...
    'PropagationSpeed',propSpeed, ...
    'OperatingFrequency',OperatingFrequency);

arrayPlat = phased.Platform('InitialPosition',[0; 0; -10],'Velocity',[0; 1; 0]);

% defining receiver amplifier for each hydrophone element. 
% Choose a gain of 20 dB and noise figure of 10 dB.

rx = phased.ReceiverPreamp(...
    'Gain',20,...
    'NoiseFigure',10,...
    'SampleRate',fs,...
    'SeedSource','Property',...
    'Seed',2007);
